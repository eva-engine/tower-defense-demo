(this["webpackJsonptower-defense-demo"]=this["webpackJsonptower-defense-demo"]||[]).push([[0],{145:function(e,t,a){},147:function(e,t,a){},148:function(e,t,a){},254:function(e,t,a){},255:function(e,t,a){},256:function(e,t,a){},257:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a.n(n),o=a(137),r=a.n(o),s=a(79),c=a(8),l=a(27),d=a(22),m={baseDamage:{normal:1,fire:1,water:1,wood:1},map:{distance:10,column:5,row:13},player:{HP:4,Gold:290,position:{x:3,y:12}},weapons:[{name:"\u666e\u901a",info:"\u666e\u901a\u653b\u51fb\u5c5e\u6027\u6b66\u5668",element:"normal",level:1,cost:14,damage:{normal:1,fire:0,water:0,wood:0},cd:500,delay:100,position:{x:1,y:12}},{name:"\u706b\u7cfb",info:"\u706b\u7cfb\u653b\u51fb\u5c5e\u6027\u6b66\u5668",element:"fire",level:1,cost:16,damage:{normal:.6,fire:1.2,water:.1,wood:0},cd:900,delay:200,position:{x:2,y:12}},{name:"\u6c34\u7cfb",info:"\u6c34\u7cfb\u653b\u51fb\u5c5e\u6027\u6b66\u5668",element:"water",level:1,cost:18,damage:{normal:1,fire:0,water:5,wood:0},cd:2e3,delay:500,position:{x:4,y:12}},{name:"\u6728\u7cfb",info:"\u6728\u7cfb\u653b\u51fb\u5c5e\u6027\u6b66\u5668",element:"wood",level:1,cost:24,damage:{normal:1.8,fire:0,water:0,wood:4.5},cd:1500,delay:500,position:{x:5,y:12}}],enemys:[{name:"\u666e\u901a\u53f2\u83b1\u59c6",element:"normal",HP:350,damage:1,resistance:{normal:1,fire:.5,water:.5,wood:.5},speed:1.2},{name:"\u706b\u7cfb\u53f2\u83b1\u59c6",element:"fire",HP:500,damage:1,resistance:{normal:.8,fire:1,water:2,wood:0},speed:1},{name:"\u6c34\u7cfb\u53f2\u83b1\u59c6",element:"water",HP:470,damage:1,resistance:{normal:.8,fire:0,water:1,wood:2},speed:1.25},{name:"\u6728\u7cfb\u53f2\u83b1\u59c6",element:"wood",HP:190,damage:1,resistance:{normal:.8,fire:2,water:0,wood:1},speed:2.5}],waves:[{element:"normal",enterTime:600,position:{x:1,y:1}},{element:"fire",enterTime:1e3,position:{x:2,y:1}},{element:"water",enterTime:1300,position:{x:3,y:1}},{element:"wood",enterTime:1600,position:{x:4,y:1}},{element:"normal",enterTime:2900,position:{x:4,y:1}},{element:"water",enterTime:3e3,position:{x:5,y:1}},{element:"wood",enterTime:3300,position:{x:5,y:1}},{element:"water",enterTime:3500,position:{x:2,y:1}},{element:"fire",enterTime:4e3,position:{x:3,y:1}},{element:"normal",enterTime:4700,position:{x:4,y:1}},{element:"wood",enterTime:6300,position:{x:1,y:1}},{element:"normal",enterTime:6800,position:{x:5,y:1}},{element:"water",enterTime:7500,position:{x:4,y:1}},{element:"fire",enterTime:8e3,position:{x:2,y:1}}]},u={baseDamage:Object(d.a)({},m.baseDamage),player:Object(d.a)({},m.player),map:Object(d.a)({},m.map),weapons:m.weapons.map((function(e){return Object(d.a)({},e)})),enemys:m.enemys.map((function(e){return Object(d.a)({},e)})),waves:m.waves.map((function(e){return Object(d.a)({},e)}))},h=(a(145),a(1));function p(e){var t=e.weapon,a=e.onSelected,n=e.selected;return Object(h.jsxs)("div",{className:"weapon",onClick:function(){a(t.element)},children:[Object(h.jsx)("div",{className:n?"weapon_building_bg element-selected":"weapon_building_bg element-unselect"}),Object(h.jsx)("div",{className:"weapon_building",children:Object(h.jsx)("div",{className:"weapon_building_img element-".concat(t.element)})}),Object(h.jsx)("div",{className:"weapon_badge element-badge-".concat(t.element)}),Object(h.jsx)("div",{className:"level",children:"LV ".concat(t.level)})]})}a(147);function v(e){var t=e.weapon,a=e.selected,i=e.restGold,o=e.onLvChange,r=Object(n.useState)(t.level),s=Object(l.a)(r,2),c=s[0],d=s[1];return Object(h.jsxs)("div",{className:"weapon_card",style:{display:a?"flex":"none"},children:[Object(h.jsxs)("div",{className:"weapon_card-intro",children:[Object(h.jsxs)("div",{className:"weapon_card-img_wrap",children:[Object(h.jsx)("div",{className:"weapon_card-img element-".concat(t.element)}),Object(h.jsx)("div",{className:"weapon_card-badge element-badge-".concat(t.element)})]}),Object(h.jsxs)("div",{className:"weapon_card-upgrade_wrap",children:[Object(h.jsx)("div",{className:"weapon_card-drowngrade",onClick:function(){1!==t.level&&(t.level-=1,d(t.level),o(-t.cost))}}),Object(h.jsx)("div",{className:"weapon_card-lv",children:"LV ".concat(c)}),Object(h.jsx)("div",{className:"weapon_card-upgrade",onClick:function(){i-t.cost<0||(t.level+=1,d(t.level),o(t.cost))}})]})]}),Object(h.jsxs)("div",{className:"weapon_card-body",children:[Object(h.jsxs)("div",{className:"weapon_card-title",children:[Object(h.jsx)("div",{className:"weapon_card-name",children:"".concat(t.name)}),Object(h.jsxs)("div",{className:"weapon_card-cost_wrap",children:[Object(h.jsx)("div",{className:"weapon_card-unit"}),Object(h.jsx)("div",{className:"weapon_card-cost",children:"".concat(t.cost)})]})]}),Object(h.jsx)("div",{className:"weapon_card-info",children:t.info})]})]})}a(148);function b(){var e=Object(c.f)(),t=Object(n.useState)(u.player.Gold),a=Object(l.a)(t,2),i=a[0],o=a[1],r=Object(n.useState)(u.weapons[0].element),s=Object(l.a)(r,2),d=s[0],m=s[1],b=Object(n.useCallback)((function(e){m(e)}),[]),f=Object(n.useCallback)((function(e){u.player.Gold-=e,o(u.player.Gold)}),[]);return Object(h.jsxs)("div",{className:"app",children:[Object(h.jsxs)("div",{className:"nav",children:[Object(h.jsx)("div",{className:"gold",children:i}),Object(h.jsx)("a",{href:"https://eva.js.org/",className:"eva",children:"Eva.js"})]}),Object(h.jsx)("div",{className:"weapons",children:u.weapons.map((function(e){return Object(h.jsx)(p,{weapon:e,onSelected:b,selected:e.element===d},e.element)}))}),Object(h.jsx)("div",{className:"separator",children:Object(h.jsx)("div",{className:"separator-img"})}),Object(h.jsx)("div",{className:"weapon-detail",children:u.weapons.map((function(e){return Object(h.jsx)(v,{weapon:e,restGold:i,onLvChange:f,selected:e.element===d},e.element)}))}),Object(h.jsx)("div",{className:"start",onClick:function(){e.push("/game")}})]})}var f,g,j,y=Object(n.memo)(b),w=a(34),O=a.n(w),x=a(62),k=a(13),N=a(7),C=a(9),_=a(0),T=a(10),D=a(25),P=a(39),X=a(28),A=a(31),S=a(40),G=a(60),E=a(61),M=a(11),R=a(12),B=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(N.a)(this,a),(n=t.call(this,e)).healthPoint=void 0,n.gold=void 0,n}return Object(C.a)(a,[{key:"init",value:function(e){var t=e.HP,a=e.Gold;this.healthPoint=t,this.gold=a}}]),a}(_.a);B.componentName="player";var I=_.h.componentObserver({player:["healthPoint"]})((j=g=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(){return Object(N.a)(this,a),t.apply(this,arguments)}return Object(C.a)(a,[{key:"update",value:function(){var e,t=this.componentObserver.clear(),a=Object(k.a)(t);try{for(a.s();!(e=a.n()).done;){var n=e.value,i=n.gameObject,o=n.component;if(i&&o instanceof B){var r=i.transform.children.find((function(e){return"player-hp"===e.gameObject.name})),s=null===r||void 0===r?void 0:r.gameObject.getComponent(A.a);s&&(s.text=Math.max(o.healthPoint,0)+""),o.healthPoint<=0&&this.game.emit("result",{win:!1})}}}catch(c){a.e(c)}finally{a.f()}}}]),a}(_.g),g.systemName="system",f=j))||f;function F(){return"undefined"!==typeof performance?performance.now()>>0:Date.now()}var H=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(){var e;Object(N.a)(this,a);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i)))._startTime=void 0,e.level=1,e}return Object(C.a)(a,[{key:"pastTime",get:function(){return(F()-this._startTime)*this.level}},{key:"startTime",get:function(){return this._startTime}},{key:"awake",value:function(){this._startTime=F()}},{key:"repeat",value:function(e,t){return setInterval(e,t/this.level)}},{key:"delay",value:function(e){var t=this;return new Promise((function(a){setTimeout(a,e/t.level)}))}}]),a}(_.a);H.componentName="clock";var z,L,Z,K=a(83),q=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(){var e;Object(N.a)(this,a);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).message=void 0,e}return Object(C.a)(a,[{key:"init",value:function(){this.message=[]}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"debug";this.message=[].concat(Object(K.a)(this.message),[[t,F(),["@".concat(this.gameObject.name)].concat(Object(K.a)(e)).join(" ")]])}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.add(t,"info")}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.add(t,"debug")}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];this.add(t,"error")}}]),a}(_.a);function W(e){var t=Math.floor(e/1e3/60),a=Math.floor(e/1e3)%60,n=e%1e3;return"".concat(t.toString().padStart(2,"0"),".").concat(a.toString().padStart(2,"0"),".").concat(n.toString().padStart(3,"0"))}q.componentName="gamelog";_.h.componentObserver({gamelog:["message"]})((Z=L=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){return Object(N.a)(this,a),t.call(this,e)}return Object(C.a)(a,[{key:"update",value:function(){var e,t=this.componentObserver.clear(),a=this.game.scene.getComponent(H),n=Object(k.a)(t);try{for(n.s();!(e=n.n()).done;){var i,o=e.value.component.message,r=Object(k.a)(o);try{for(r.s();!(i=r.n()).done;){var s=Object(l.a)(i.value,3),c=s[0],d=s[1],m=s[2];console[c]("[".concat(W(d-a.startTime),"] ").concat(m))}}catch(u){r.e(u)}finally{r.f()}o.length=0}}catch(u){n.e(u)}finally{n.f()}}}]),a}(_.g),L.systemName="gamelog",z=Z));var V,Y,U,J=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(N.a)(this,a),(n=t.call(this,e)).transform=void 0,n.x=void 0,n.y=void 0,n}return Object(C.a)(a,[{key:"init",value:function(e){this.transform=e,this.x=e.position.x,this.y=e.position.y}}]),a}(_.a);J.componentName="map";var Q,$,ee,te=_.h.componentObserver({map:["x","y"]})((U=Y=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(N.a)(this,a),(n=t.call(this,e)).ceil={width:0,height:0},n.routeDistance=void 0,n.helper=void 0,n.grids=[],n.width=void 0,n.height=void 0,n.column=void 0,n.row=void 0,n}return Object(C.a)(a,[{key:"init",value:function(e){var t=e.width,a=e.height,n=e.column,i=e.row,o=e.distance,r=e.helper,s=void 0!==r&&r;this.width=t,this.height=a,this.column=n,this.row=i,this.routeDistance=o,this.helper=s,this.ceil.width=Math.floor(t/n),this.ceil.height=Math.floor(a/i);for(var c=0;c<i;c++){this.grids[c]=[];for(var l=0;l<n;l++)this.grids[c].push({position:{x:l*this.ceil.width,y:c*this.ceil.height}})}}},{key:"start",value:function(){if(this.helper){var e=new _.c("mapGridHelper",{size:{width:this.width,height:this.height}}),t=e.addComponent(new D.a);t.graphics.lineStyle(2,13421772,1);for(var a=0;a<this.row;a++)t.graphics.moveTo(this.grids[a][0].position.x,this.grids[a][0].position.y),t.graphics.lineTo(this.grids[a][this.column-1].position.x+this.ceil.width,this.grids[a][this.column-1].position.y);for(var n=0;n<this.column;n++)t.graphics.moveTo(this.grids[0][n].position.x,this.grids[0][n].position.y),t.graphics.lineTo(this.grids[this.row-1][n].position.x,this.grids[this.row-1][n].position.y+this.ceil.height);this.game.scene.addChild(e)}}},{key:"update",value:function(){var e,t=this.componentObserver.clear(),a=Object(k.a)(t);try{for(a.s();!(e=a.n()).done;){var n=e.value,i=n.gameObject,o=n.component;if(i){var r=i.getComponent(q);if(o instanceof J&&i.transform){var s,c,l,d,m,u,h,p,v=this.grids[o.y-1][o.x-1].position,b=v.x,f=v.y;b+=this.ceil.width*((null===(s=o.transform)||void 0===s||null===(c=s.anchor)||void 0===c?void 0:c.x)||0),f+=this.ceil.height*((null===(l=o.transform)||void 0===l||null===(d=l.anchor)||void 0===d?void 0:d.y)||0),b-=i.transform.size.width*((null===(m=o.transform)||void 0===m||null===(u=m.origin)||void 0===u?void 0:u.x)||0),f-=i.transform.size.height*((null===(h=o.transform)||void 0===h||null===(p=h.origin)||void 0===p?void 0:p.y)||0),i.transform.position.x=b,i.transform.position.y=f,r.debug("move to [".concat(o.x,", ").concat(o.y,"]"))}}}}catch(g){a.e(g)}finally{a.f()}}}]),a}(_.g),Y.systemName="map",V=U))||V,ae=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(){var e;Object(N.a)(this,a);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).count=0,e}return a}(_.a);ae.componentName="wave";var ne,ie,oe,re,se=_.h.componentObserver({wave:["count"]})((ee=$=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(N.a)(this,a),(n=t.call(this,e)).waves=void 0,n}return Object(C.a)(a,[{key:"init",value:function(e){this.waves=e}},{key:"update",value:function(){var e,t,a=this.componentObserver.clear();a.length>0&&(e=null===(t=this.game.scene.gameObjects.find((function(e){return"player"===e.name})))||void 0===t?void 0:t.getComponent(B));var n,i=Object(k.a)(a);try{for(i.s();!(n=i.n()).done;){var o=n.value.component;o instanceof ae&&o.count>=this.waves.length&&this.game.emit("result",{win:e&&e.healthPoint>0})}}catch(r){i.e(r)}finally{i.f()}}}]),a}(_.g),$.systemName="wave",Q=ee))||Q;!function(e){e[e.idle=0]="idle",e[e.walking=1]="walking",e[e.ending=2]="ending",e[e.dead=3]="dead",e[e.queen=4]="queen"}(re||(re={}));var ce=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(N.a)(this,a),(n=t.call(this,e)).enemyName=void 0,n.element=void 0,n.healthPoint=void 0,n.HP=void 0,n.damage=void 0,n.resistance=void 0,n.speed=void 0,n.status=re.idle,n.moving=void 0,n.distance=0,n}return Object(C.a)(a,[{key:"init",value:function(e){var t=e.name,a=e.element,n=e.HP,i=e.damage,o=e.resistance,r=e.speed;this.enemyName=t,this.element=a,this.healthPoint=n,this.HP=n,this.damage=i,this.resistance=o,this.speed=r}},{key:"onDestroy",value:function(){clearInterval(this.moving)}},{key:"enter",value:function(){this.status=re.walking,this.gameObject.getComponent(P.a).play("newAnimation"),this.distance=0}},{key:"move",value:function(){var e=this,t=this.gameObject.scene.getComponent(H);this.moving=t.repeat((function(){e.status===re.walking&&(e.distance+=1)}),1e3/this.speed)}},{key:"die",value:function(){clearInterval(this.moving),this.status=re.dead}},{key:"victory",value:function(){clearInterval(this.moving),this.status=re.queen}}]),a}(_.a);ce.componentName="enemy";var le,de,me,ue=_.h.componentObserver({enemy:["distance","healthPoint"]})((oe=ie=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){return Object(N.a)(this,a),t.call(this,e)}return Object(C.a)(a,[{key:"update",value:function(){var e,t,a,n,i=this.componentObserver.clear();i.length>0&&(e=this.game.getSystem(te),t=this.game.scene.getComponent(ae),a=null===(n=this.game.scene.gameObjects.find((function(e){return"player"===e.name})))||void 0===n?void 0:n.getComponent(B));var o,r=Object(k.a)(i);try{for(r.s();!(o=r.n()).done;){var s,c=o.value,l=c.gameObject,d=c.component,m=(null===(s=c.prop)||void 0===s?void 0:s.prop)||[];if(l){var u=l.getComponent(J),h=l.getComponent(q);if(d instanceof ce){var p,v=Object(k.a)(m);try{for(v.s();!(p=v.n()).done;){switch(p.value){case"distance":e&&d.distance>=e.routeDistance?d.healthPoint>0&&(a&&(a.healthPoint-=d.damage,null===h||void 0===h||h.debug("attack Player with ".concat(d.damage,"HP"))),t&&(t.count+=1),d.victory(),l.destroy()):u.y=u.transform.position.y+d.distance;break;case"healthPoint":if(null===h||void 0===h||h.debug("left ".concat(d.healthPoint,"HP")),d.healthPoint<=0)t&&(t.count+=1),d.die(),l.destroy();else{var b,f,g=null===l||void 0===l||null===(b=l.transform)||void 0===b?void 0:b.children.find((function(e){return"health-bar"===e.gameObject.name})),j=null===g||void 0===g||null===(f=g.gameObject)||void 0===f?void 0:f.getComponent(D.a);if(j){var y=Math.floor(Math.max(10,d.healthPoint/d.HP*150));j.graphics.clear(),j.graphics.beginFill(14561865,1),j.graphics.drawRoundedRect(0,0,y,24,9),j.graphics.endFill()}}}}}catch(w){v.e(w)}finally{v.f()}}}}}catch(w){r.e(w)}finally{r.f()}}}]),a}(_.g),ie.systemName="enemy",ne=oe))||ne,he=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(N.a)(this,a),(n=t.call(this,e)).weaponName=void 0,n.level=void 0,n.element=void 0,n.damage=void 0,n.cd=void 0,n.delay=void 0,n.attackCount=void 0,n.attacking=void 0,n}return Object(C.a)(a,[{key:"init",value:function(e){var t=e.name,a=e.level,n=void 0===a?1:a,i=e.element,o=e.damage,r=e.cd,s=e.delay;this.weaponName=t,this.level=n,this.element=i,this.damage=o,this.cd=r,this.delay=s,this.attackCount=0}},{key:"multiDamge",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{normal:Math.round(e.normal*t.normal*a),fire:Math.round(e.fire*t.fire*a),water:Math.round(e.water*t.water*a),wood:Math.round(e.wood*t.wood*a)}}},{key:"sumDamange",value:function(e){return e.normal+e.fire+e.water+e.wood}},{key:"attack",value:function(){var e=this,t=this.gameObject.scene.getComponent(H);t.delay(this.delay).then((function(){e.attacking=t.repeat((function(){e.attackCount+=1,e.emit("attack")}),e.cd)}))}},{key:"onDestroy",value:function(){clearInterval(this.attackCount)}}]),a}(_.a);he.componentName="weapon";var pe=_.h.componentObserver({weapon:["attackCount"]})((me=de=function(e){Object(M.a)(a,e);var t=Object(R.a)(a);function a(e){var n;return Object(N.a)(this,a),(n=t.call(this,e)).baseDamage=void 0,n}return Object(C.a)(a,[{key:"init",value:function(e){this.baseDamage=e}},{key:"update",value:function(){var e=this.componentObserver.clear(),t=[];e.length>0&&(t=this.game.scene.gameObjects.filter((function(e){return!!e.getComponent(ce)})));var a,n=Object(k.a)(e);try{for(n.s();!(a=n.n()).done;){var i=a.value,o=i.component,r=i.gameObject;if(r){var s=r.getComponent(q),c=r.getComponent(X.a);if(o instanceof he&&o.attackCount>0){var l=o.multiDamge(this.baseDamage,o.damage,o.level);c.emit("playIdle",1);var d,m=Object(k.a)(t);try{for(m.s();!(d=m.n()).done;){var u=d.value,h=u.getComponent(ce),p=o.sumDamange(o.multiDamge(l,h.resistance));h.healthPoint-=p,s.debug("attack @".concat(u.name," with ").concat(p," HP"))}}catch(v){m.e(v)}finally{m.f()}}}}}catch(v){n.e(v)}finally{n.f()}}}]),a}(_.g),de.systemName="weapon",le=me))||le;function ve(e){var t=e.name,a=e.width,n=void 0===a?0:a,i=e.height,o=void 0===i?0:i,r=e.scale,s=void 0===r?1:r,c=e.x,l=e.y,d=e.graphic,m=e.image,u=e.dragonebone,h=new _.c(t,{size:{width:n,height:o},scale:{x:s,y:s}}),p=h.addComponent(new X.a);if(h.addComponent(new q),h.addComponent(new J({anchor:{x:.5,y:.5},origin:{x:.5,y:.5},position:{x:c,y:l}})),d){var v=h.addComponent(new D.a);switch(v.graphics.beginFill(d.color,1),d.shape){case"rect":v.graphics.drawRect(0,0,n,o);break;case"circle":v.graphics.drawCircle(n/2,o/2,n/2);break;case"star":v.graphics.drawStar(n/2,o/2,5,n/2)}v.graphics.endFill()}if(m&&h.addComponent(new S.a({resource:m.resource})),u){var b=h.addComponent(new P.a({resource:u.resource,armatureName:u.armatureName,autoPlay:!1}));p.on("playIdle",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;b.play(u.animationName,e)}))}return h}var be=[{name:"player",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/robot/TB13RfXrwgP7K4jSZFqXXamhVXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/robot/649a2382b6e70d4d3d9096301e1e9b0e.json"},ske:{type:"json",url:"./assets/dragonbone/robot/9f25675eaad7275307f4969cbad4fe99.json"}},preload:!0},{name:"player-heart",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/heart.png"}},preload:!0}];var fe=[{name:"normal-weapon",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/normal-weapon/TB1D1mM4Lb2gK0jSZK9XXaEgFXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/normal-weapon/53f7268e6db5a0d8aa7765e721d6c50c.json"},ske:{type:"json",url:"./assets/dragonbone/normal-weapon/6a0de7df81565d7eeee74a7a5d5c90a2.json"}},preload:!0},{name:"fire-weapon",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/fire-weapon/TB1Y65H4KL2gK0jSZPhXXahvXXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/fire-weapon/2d18bc3f44529c8bb0745230b2008331.json"},ske:{type:"json",url:"./assets/dragonbone/fire-weapon/bf59a0d33ba196fdf17401cc2ff35d04.json"}},preload:!0},{name:"water-weapon",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/water-weapon/TB1zsuL4Uz1gK0jSZLeXXb9kVXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/water-weapon/fcc75c846bc10c6631a282218cbb77e4.json"},ske:{type:"json",url:"./assets/dragonbone/water-weapon/469a8af43daec65b35d9d9a0a257a472.json"}},preload:!0},{name:"wood-weapon",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/wood-weapon/TB12teOt_M11u4jSZPxXXahcXXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/wood-weapon/42726fc745c6e3c227a9c8d28865d49d.json"},ske:{type:"json",url:"./assets/dragonbone/wood-weapon/6bad23c6f2966b0c952a95cb2fdce202.json"}},preload:!0}],ge={normal:"slimer_nor",fire:"tower_fire",water:"arms-water",wood:"weapon_mu"};function je(e){var t=e.data,a=e.x,n=e.y,i=ve({name:"".concat(t.element,"-weapon"),scale:.7,x:a,y:n,dragonebone:{resource:"".concat(t.element,"-weapon"),armatureName:ge[t.element],animationName:"newAnimation"}});i.addComponent(new he(t));var o=new _.c("".concat(t.element,"-weapon"),{position:{x:0,y:120},origin:{x:.5,y:.5}});return o.addComponent(new A.a({text:"LV ".concat(t.level),style:{fontSize:40,fill:16777215}})),i.addChild(o),i}var ye=[{name:"normal-bullet",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/normal-bullet.png"}},preload:!0},{name:"fire-bullet",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/fire-bullet.png"}},preload:!0},{name:"water-bullet",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/water-bullet.png"}},preload:!0},{name:"wood-bullet",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/wood-bullet.png"}},preload:!0}];function we(e){var t=e.data,a=e.x,n=e.y,i=ve({name:"".concat(t.element,"-weapon"),width:750,height:1334,x:a,y:n,image:{resource:"".concat(t.element,"-bullet")}}),o=i.addComponent(new G.a({alpha:0}));i.removeComponent(J);var r=i.addComponent(new E.a);r.group={fire:[{name:"alpha",component:o,values:[{time:0,value:0,tween:"ease-in"},{time:50,value:1,tween:"linear"},{time:350,value:1,tween:"ease-out"},{time:400,value:0}]},{name:"position.y",component:i.transform,values:[{time:0,value:300,tween:"ease-out"},{time:400,value:-100}]}]};var s=i.getComponent(X.a);return s.on("fire",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;r.play("fire",e),r.once("finish",(function(){return s.emit("fireend")}))})),i}var Oe=[{name:"normal-enemy",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/enemy-normal/TB1XrNR4UY1gK0jSZFMXXaWcVXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/enemy-normal/86d3a8d59acaf29d24c8db90a8c2113e.json"},ske:{type:"json",url:"./assets/dragonbone/enemy-normal/c8c2a5ab1f07ec118d8341770b025377.json"}},preload:!0},{name:"water-enemy",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/enemy-water/TB155BQ4FT7gK0jSZFpXXaTkpXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/enemy-water/9e750ffd7a4e22de9a1b07f2c2d647be.json"},ske:{type:"json",url:"./assets/dragonbone/enemy-water/d54d187987edd2f9301a0954b0457673.json"}},preload:!0},{name:"fire-enemy",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/enemy-fire/TB1xcFzqQcx_u4jSZFlXXXnUFXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/enemy-fire/9aa0f6c67e7f4b674ecbdd14d6261434.json"},ske:{type:"json",url:"./assets/dragonbone/enemy-fire/9f628e03da2e9ee5f441d496d68167e0.json"}},preload:!0},{name:"wood-enemy",type:_.f.DRAGONBONE,src:{image:{type:"png",url:"./assets/dragonbone/enemy-wood/TB1sbpZ4UY1gK0jSZFCXXcwqXXa-256-256.png"},tex:{type:"json",url:"./assets/dragonbone/enemy-wood/8c54ab67e9abdb571749403a51b0f3e1.json"},ske:{type:"json",url:"./assets/dragonbone/enemy-wood/deb0c3308470969e2fd6a455be4fb368.json"}},preload:!0},{name:"normal-enemy-badge",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/element_badge_normal.png"}},preload:!0},{name:"fire-enemy-badge",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/element_badge_fire.png"}},preload:!0},{name:"water-enemy-badge",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/element_badge_water.png"}},preload:!0},{name:"wood-enemy-badge",type:_.f.IMAGE,src:{image:{type:"png",url:"./assets/image/element_badge_wood.png"}},preload:!0}],xe={normal:{scale:.6,armatureName:"slimer_mu"},fire:{scale:.5,armatureName:"slimer_fire"},water:{scale:.6,armatureName:"slimer_water"},wood:{scale:.45,armatureName:"slimer_mu-01"}};_.i.addResource([].concat(be,fe,Oe,ye)),_.i.preload();var ke=function(){function e(t){Object(N.a)(this,e),this.userData=void 0,this.game=void 0,this.player=void 0,this.enemys=[],this.weapons=[],this.userData=t}return Object(C.a)(e,[{key:"initGame",value:function(e){var t=e.offsetWidth,a=e.offsetHeight/t*750;this.game=new _.b({frameRate:60,autoStart:!1,systems:[new pe(this.userData.baseDamage),new ue,new se(this.userData.waves),new I,new te(Object(d.a)({width:750,height:a},this.userData.map)),new T.b({canvas:e,width:750,height:a,transparent:!0,resoution:.5}),new A.b,new X.b,new D.b,new P.b,new S.b,new E.b,new G.b]})}},{key:"addPlayer",value:function(){this.player=function(e){var t=e.data,a=ve({name:"player",x:e.x,y:e.y,scale:.5,dragonebone:{resource:"player",armatureName:"robot",animationName:"newAnimation"}});a.addComponent(new B(t));var n=new _.c("player-heart",{size:{width:60,height:60},origin:{x:.5,y:.5},position:{x:-20,y:-240}});n.addComponent(new S.a({resource:"player-heart"}));var i=new _.c("player-hp",{origin:{x:.5,y:.5},position:{x:50,y:-240}});return i.addComponent(new A.a({text:t.HP,style:{fontSize:60,fill:14163462,stroke:16777215,strokeThickness:10}})),a.addChild(n),a.addChild(i),a}(Object(d.a)({data:this.userData.player},this.userData.player.position)),this.player.getComponent(X.a).emit("playIdle",1/0),this.game.scene.addChild(this.player)}},{key:"addWeapons",value:function(){var e,t=Object(k.a)(this.userData.weapons);try{for(t.s();!(e=t.n()).done;){var a=e.value,n=je(Object(d.a)({data:a},a.position));this.game.scene.addChild(n),this.weapons.push(n)}}catch(i){t.e(i)}finally{t.f()}}},{key:"initScene",value:function(){this.addPlayer(),this.addWeapons(),this.game.scene.addComponent(new H),this.game.scene.addComponent(new ae)}},{key:"init",value:function(e){this.initGame(e),this.initScene()}},{key:"addEnemy",value:function(e,t){var a=this.userData.enemys.find((function(t){return t.element===e}));if(a){var n=function(e){var t=e.data,a=e.x,n=e.y,i=xe[t.element],o=ve({name:"".concat(t.element,"-enemy"),scale:i.scale,x:a,y:n,dragonebone:{resource:"".concat(t.element,"-enemy"),armatureName:i.armatureName,animationName:"newAnimation"}});o.addComponent(new ce(t));var r=new _.c("badge",{size:{width:60,height:60},position:{x:-80,y:-120},origin:{x:.5,y:.5}});r.addComponent(new S.a({resource:"".concat(t.element,"-enemy-badge")}));var s=new _.c("health-bar-border",{position:{x:20,y:-120},origin:{x:.5,y:.5},size:{width:160,height:32}}),c=s.addComponent(new D.a);c.graphics.beginFill(16777215,1),c.graphics.drawRoundedRect(0,0,160,32,12),c.graphics.endFill();var l=new _.c("health-bar",{position:{x:-60,y:-132},size:{width:150,height:24}}),d=l.addComponent(new D.a);return d.graphics.beginFill(14561865,1),d.graphics.drawRoundedRect(0,0,150,24,9),d.graphics.endFill(),o.addChild(r),o.addChild(s),o.addChild(l),o}(Object(d.a)({data:a},t));return this.game.scene.addChild(n),n}}},{key:"startWave",value:function(){var e=Object(x.a)(O.a.mark((function e(){var t,a,n,i,o,r,s,c,l,d;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.game.scene.getComponent(H),a=Object(k.a)(this.userData.waves),e.prev=2,a.s();case 4:if((n=a.n()).done){e.next=14;break}if(i=n.value,o=i.element,r=i.enterTime,s=i.position,!((c=t.pastTime)<r)){e.next=10;break}return e.next=10,t.delay(r-c);case 10:(l=this.addEnemy(o,s))&&(this.enemys.push(l),(d=l.getComponent(ce)).enter(),d.move());case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[2,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"startAttack",value:function(){var e=Object(x.a)(O.a.mark((function e(){var t,a,n,i=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(k.a)(this.weapons);try{for(n=function(){var e=a.value.getComponent(he);e.on("attack",(function(){return i.attackEffect(e.element)})),e.attack()},t.s();!(a=t.n()).done;)n()}catch(o){t.e(o)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attackEffect",value:function(){var e=Object(x.a)(O.a.mark((function e(t){var a,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=we({data:{element:t},x:3,y:10}),this.game.scene.addChild(a),(n=a.getComponent(X.a)).on("fireend",(function(){return a.remove()})),n.emit("fire",1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=this;return this.game.start(),this.startWave(),this.startAttack(),new Promise((function(t){e.game.once("result",(function(e){t(e)}))}))}},{key:"pause",value:function(){this.game.pause()}},{key:"destory",value:function(){this.game.destroy()}}]),e}();a(254);function Ne(e){var t=e.result,a=Object(n.useCallback)((function(){window.location.replace("?t=".concat(Date.now()))}),[]);return null===t?null:Object(h.jsxs)("div",{className:"result",children:[Object(h.jsxs)("div",{className:"text",children:[Object(h.jsx)("div",{className:"title",children:(null===t||void 0===t?void 0:t.win)?Object(h.jsx)("div",{className:"win",children:Object(h.jsxs)("h2",{children:["You ",Object(h.jsx)("b",{children:"Win!"})]})}):Object(h.jsxs)("div",{className:"lose",children:[Object(h.jsxs)("h2",{children:["You ",Object(h.jsx)("b",{children:"Lose!"})]}),Object(h.jsx)("span",{children:"\u53ef\u4ee5\u8c03\u6574\u5854\u7684\u7ea7\u522b\u8bd5\u8bd5\u54e6\uff01"})]})}),Object(h.jsxs)("div",{className:"staff",children:[Object(h.jsxs)("ul",{children:[Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon normal-weapon-icon "}),Object(h.jsx)("b",{children:"\u7b56\u5212\uff1a"}),Object(h.jsx)("i",{children:"\u9f50\u7eaa"})]}),Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon fire-weapon-icon"}),Object(h.jsx)("b",{children:"\u4ea7\u54c1\uff1a"}),Object(h.jsx)("i",{children:"\u7700\u975e"})]}),Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon water-weapon-icon"}),Object(h.jsx)("b",{children:"\u4ea7\u54c1\uff1a"}),Object(h.jsx)("i",{children:"\u8574\u5149"})]}),Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon wood-weapon-icon"}),Object(h.jsx)("b",{children:"\u6570\u503c\uff1a"}),Object(h.jsx)("i",{children:"\u5149\u9a70"})]}),Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon eva-icon"}),Object(h.jsx)("b",{children:"\u8d28\u91cf\uff1a"}),Object(h.jsx)("i",{children:"\u4ee5\u987a"})]})]}),Object(h.jsxs)("ul",{children:[Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon normal-enemy-icon"}),Object(h.jsx)("b",{children:"\u539f\u753b\uff1a"}),Object(h.jsx)("i",{children:"\u591c\u7fce"})]}),Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon fire-enemy-icon"}),Object(h.jsx)("b",{children:"\u7f8e\u672f\uff1a"}),Object(h.jsx)("i",{children:"\u5f02\u94ed"})]}),Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon water-enemy-icon"}),Object(h.jsx)("b",{children:"\u7a0b\u5e8f\uff1a"}),Object(h.jsx)("i",{children:"\u6e1a\u85b0"})]}),Object(h.jsxs)("li",{children:[Object(h.jsx)("i",{className:"icon wood-enemy-icon"}),Object(h.jsx)("b",{children:"\u7a0b\u5e8f\uff1a"}),Object(h.jsx)("i",{children:"\u5bb5\u4e50"})]})]})]}),Object(h.jsxs)("h3",{children:[Object(h.jsx)("i",{className:"icon brand-icon"}),Object(h.jsx)("a",{href:"https://www.yuque.com/eva/blog/intro",children:"\u6dd8\u7cfb\u4e92\u52a8@copyright"})]})]}),Object(h.jsx)("div",{className:"button",onClick:a,children:"RESTART"})]})}a(255);function Ce(){var e=Object(n.useState)(null),t=Object(l.a)(e,2),a=t[0],i=t[1],o=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e;return null===a&&o.current&&((e=new ke(u)).init(o.current),e.start().then((function(e){i(e)}))),function(){return e.destory()}}),[a]),Object(h.jsxs)("div",{className:"game",children:[Object(h.jsx)("canvas",{ref:o}),Object(h.jsx)(Ne,{result:a})]})}var _e=Object(n.memo)(Ce);a(256);var Te=function(){return Object(h.jsx)(s.a,{children:Object(h.jsxs)(c.c,{children:[Object(h.jsx)(c.a,{path:"/game",strict:!0,children:Object(h.jsx)(_e,{})}),Object(h.jsx)(c.a,{path:"/",strict:!0,children:Object(h.jsx)(y,{})})]})})};r.a.render(Object(h.jsx)(i.a.StrictMode,{children:Object(h.jsx)(Te,{})}),document.getElementById("root"))}},[[257,1,2]]]);
//# sourceMappingURL=main.be7e31ee.chunk.js.map